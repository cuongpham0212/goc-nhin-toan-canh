let canvas,ctx,stars=[],animationId=null,running=!1,startTime=0;const MIN_OVERLAY_DURATION=3e3;let overlayEl=null;function initStarsCanvas(){if(running)return;if(overlayEl=document.querySelector(".tarot-overlay"),canvas=document.getElementById("stars-canvas"),!canvas||!overlayEl)return;ctx=canvas.getContext("2d"),resizeCanvas(),(!canvas.width||!canvas.height)&&(canvas.width=window.innerWidth,canvas.height=window.innerHeight);const e=window.innerWidth<768?170:340;stars=Array.from({length:e},()=>{const e=Math.random();return e<.75?{x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*.8+.3,o:Math.random()*.35+.15,d:Math.random()*.002+.001,glow:0}:e<.9?{x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*1.2+.6,o:Math.random()*.6+.3,d:Math.random()*.006+.003,glow:6}:{x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*1.8+1.2,o:Math.random()*.8+.6,d:Math.random()*.004+.002,glow:14}}),overlayEl.hidden=!1,running=!0,startTime=Date.now(),animateStars()}function resizeCanvas(){if(!canvas)return;canvas.width=window.innerWidth,canvas.height=window.innerHeight}function animateStars(){if(!running)return;ctx.clearRect(0,0,canvas.width,canvas.height),stars.forEach(e=>{e.o+=e.d,(e.o>=1||e.o<=0)&&(e.d*=-1),ctx.beginPath(),ctx.arc(e.x,e.y,e.r,0,Math.PI*2),ctx.fillStyle=`rgba(255,255,255,${e.o})`,e.glow>0?(ctx.shadowBlur=e.glow,ctx.shadowColor="rgba(160,180,255,0.9)"):ctx.shadowBlur=0,ctx.fill()}),ctx.shadowBlur=0,animationId=requestAnimationFrame(animateStars)}function stopStarsCanvas(){const e=Date.now()-startTime,t=Math.max(0,MIN_OVERLAY_DURATION-e);setTimeout(()=>{running=!1,animationId&&(cancelAnimationFrame(animationId),animationId=null),ctx&&canvas&&ctx.clearRect(0,0,canvas.width,canvas.height),overlayEl&&(overlayEl.hidden=!0)},t)}window.addEventListener("resize",resizeCanvas),window.startStars=initStarsCanvas,window.stopStars=stopStarsCanvas