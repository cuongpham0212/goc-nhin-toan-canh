document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("tarot-data");if(!r)return;let t=JSON.parse(r.textContent);if(typeof t=="string"&&(t=JSON.parse(t)),!Array.isArray(t)||t.length===0)return;const s="https://cdn.jsdelivr.net/gh/cuongpham0212/kho-anh@main/tarot/anh-mat-sau-la-bai-tarot.webp",o=document.querySelectorAll(".tarot-slot"),a=document.getElementById("reveal-reading"),i=document.getElementById("tarot-overlay"),l=document.querySelector(".tarot-panel"),c=document.getElementById("tarot-reading"),h=document.getElementById("reading-1"),u=document.getElementById("reading-2"),d=document.getElementById("reading-3");if(o.length!==3)return;let n=t.map((e,t)=>t),e=[];function m(){const e=Math.floor(Math.random()*n.length);return n.splice(e,1)[0]}function f(e){const t=document.createElement("div");t.className="tarot-card";const n=document.createElement("div");n.className="tarot-face back",n.innerHTML=`<img src="${s}" alt="Tarot back">`;const o=document.createElement("div");return o.className="tarot-face front",o.innerHTML=`<img src="${e}" alt="Tarot front">`,t.appendChild(n),t.appendChild(o),t}o.forEach(e=>{e.innerHTML="";const t=f(s);e.appendChild(t)}),o.forEach((o,i)=>{o.addEventListener("click",()=>{if(e[i])return;if(n.length===0)return;const l=m(),r=t[l];e[i]=r;const c=o.querySelector(".tarot-card"),d=c.querySelector(".tarot-face.front img");d.src=r.image&&r.image.trim()?r.image:s,requestAnimationFrame(()=>{c.classList.add("is-flipped")}),e.filter(Boolean).length===3&&(a.disabled=!1)})}),a.addEventListener("click",()=>{if(e.length!==3)return;i&&(i.hidden=!1),setTimeout(()=>{document.body.classList.remove("tarot-before"),document.body.classList.add("tarot-after"),l?.classList.add("is-active"),h.textContent=e[0].summary||e[0].guidance||"",u.textContent=e[1].summary||e[1].emotion||"",d.textContent=e[2].guidance||e[2].summary||"",c.hidden=!1,i.hidden=!0,c.scrollIntoView({behavior:"smooth",block:"start"})},1200)})})