{{ define "main" }}

<!-- ==================================================
     TAROT APP ‚Äì RITUAL MODE (HTML MAP ‚Äì CLEAN)
     ================================================== -->

<!-- ==================================================
     OVERLAY ‚Äì MUST BE OUTSIDE TAROT APP ROOT
     ================================================== -->
{{ partial "tarot/tarot-overlay.html" . }}

<div class="tarot-page tarot-app-root" data-tarot-root>

  <div class="tarot-app" data-tarot-app>

    <!-- ================= HEADER ================= -->
    <header class="tarot-header">
      <h1>{{ .Title }}</h1>
      {{ with .Content }}
      <div class="tarot-intro">
        {{ . }}
      </div>
      {{ end }}
    </header>

    <!-- ================= GUIDE ================= -->
    <section class="tarot-guide">
      <p>
        H√£y h√≠t th·ªü s√¢u, th·∫£ l·ªèng t√¢m tr√≠ v√† t·∫≠p trung v√†o c√¢u h·ªèi trong l√≤ng b·∫°n.
        Vi·ªác ch·ªçn b√†i ho√†n to√†n d·ª±a tr√™n <strong>tr·ª±c gi√°c</strong>.
      </p>
    </section>

    <!-- ================= TAROT STAGE ================= -->
    <section class="tarot-stage" data-tarot-stage>

      <!-- GAME SPACE = MAP -->
      <div class="tarot-game-space tarot-deck-area" data-tarot-space>

        <!-- ================= TOP STAGE ================= -->
        <div class="tarot-stage-top" data-tarot-stage-top>

          <!-- ===== DECK A: √öP (SOURCE) ===== -->
          <div class="tarot-col tarot-col--left" data-tarot-col="A">
            <div
              class="tarot-deck-stack deck-a"
              id="deck-closed"
              data-deck="A"
              data-deck-role="source"
            >
              <div class="tarot-deck tarot-deck--source" data-deck-visual>
                <img
                  src="https://cdn.jsdelivr.net/gh/cuongpham0212/kho-anh@main/tarot/anh-mat-sau-la-bai-tarot.webp"
                  alt="Tarot deck"
                  data-card-face="back"
                />
              </div>
            </div>

            <div class="tarot-shuffle-box">
              <button
                id="btn-shuffle"
                class="tarot-btn"
                type="button"
                data-action="shuffle"
              >
                X√†o b√†i
              </button>
            </div>
          </div>

          <!-- ===== DECK B: X√ÄO (SHUFFLE) ===== -->
          <div class="tarot-col tarot-col--right" data-tarot-col="B">
            <div
              class="tarot-deck-stack deck-b"
              id="deck-shuffle"
              data-deck="B"
              data-deck-role="shuffle"
            >
              <div class="tarot-deck tarot-deck--shuffle" data-deck-visual>
                <img
                  src="https://cdn.jsdelivr.net/gh/cuongpham0212/kho-anh@main/tarot/anh-mat-sau-la-bai-tarot.webp"
                  alt="Shuffled deck"
                  data-card-face="back"
                />
              </div>

              <!-- SLOT HI·ªÜU ·ª®NG X√ÄO -->
              <div
                class="tarot-shuffle-stage"
                data-shuffle-stage
              ></div>
            </div>
          </div>

        </div>
        <!-- /top -->

        <!-- ================= BOTTOM STAGE ================= -->
        <div class="tarot-stage-bottom" data-tarot-stage-bottom>

          <!-- ===== DECK FLAT: GOM B√ÄI (C·∫¶U N·ªêI) ===== -->
          <div
            class="tarot-flat-deck"
            data-deck-flat
            aria-hidden="true"
          ></div>

          <!-- ===== DECK C: TR·∫¢I (TARGET / SPREAD) ===== -->
          <div
            class="tarot-spread-area deck-c"
            id="deck-spread"
            data-deck="C"
            data-deck-role="spread"
          >
            <div
              class="tarot-spread-slots"
              data-spread-slots
            ></div>
          </div>

        </div>
        <!-- /bottom -->

      </div>
      <!-- /game-space -->

    </section>

    <!-- ================= AFTER STAGE ================= -->
    <section class="tarot-after-stage hidden" data-tarot-after>

      <!-- üîí INNER CONTAINER ‚Äì FIX CANH L·ªÄ TO√ÄN B·ªò H·∫¨U NGHI L·ªÑ -->
      <div class="tarot-after-inner">

        <section class="tarot-selected">
          <h2>Ba l√° b·∫°n ƒë√£ ch·ªçn</h2>

          <div class="tarot-selected-cards">
            {{ range $i, $label := slice "QU√Å KH·ª®" "HI·ªÜN T·∫†I" "H∆Ø·ªöNG ƒêI" }}
            <div class="tarot-slot-wrap">
              <div class="tarot-slot-label">
                L√Å {{ add $i 1 }} ¬∑ {{ $label }}
              </div>
              <div
                class="tarot-slot"
                data-slot="{{ add $i 1 }}"
              ></div>
            </div>
            {{ end }}
          </div>
        </section>

        <!-- ACTION: N√öT XEM LU·∫¨N GI·∫¢I -->
        <div class="tarot-action">
          <button
            id="btn-reading"
            class="tarot-btn is-disabled"
            disabled
            data-action="reading"
          >
            Xem lu·∫≠n gi·∫£i
          </button>
        </div>

        <!-- N·ªòI DUNG LU·∫¨N GI·∫¢I -->
        <article
          id="reading-content"
          class="tarot-reading hidden"
          data-reading-content
        ></article>

        <!-- FOOTER: N√öT RESET (NAY ƒê√É N·∫∞M TRONG KH·ªêI) -->
        <div class="tarot-reading-footer">
          <button
            id="btn-reset"
            class="tarot-btn hidden"
            type="button"
            data-action="reset"
          >
            Xem tr·∫£i b√†i kh√°c
          </button>
        </div>

      </div>
      <!-- /tarot-after-inner -->

    </section>

  </div>
</div>

{{ $tarot := resources.Get "js/tarot/tarot-map-app.js"
  | js.Build (dict
      "format" "esm"
      "targetPath" "js/tarot-map-app.js"
    )
  | resources.Fingerprint
}}

<script
  type="module"
  src="{{ $tarot.RelPermalink }}"
  integrity="{{ $tarot.Data.Integrity }}"
></script>

{{ end }}
