{{ define "main" }}

<!-- ==================================================
     TAROT APP – RITUAL MODE (HTML MAP – CLEAN)
     ================================================== -->

<!-- ==================================================
     OVERLAY – MUST BE OUTSIDE TAROT APP ROOT
     ================================================== -->
{{ partial "tarot/tarot-overlay.html" . }}

<div class="tarot-page tarot-app-root" data-tarot-root>

  <div class="tarot-app" data-tarot-app>

    <!-- ================= HEADER ================= -->
    <header class="tarot-header">
      <h1>{{ .Title }}</h1>
      {{ with .Content }}
      <div class="tarot-intro">
        {{ . }}
      </div>
      {{ end }}
    </header>

    <!-- ================= GUIDE ================= -->
    <section class="tarot-guide">
      <p>
        Hãy hít thở sâu, thả lỏng tâm trí và tập trung vào câu hỏi trong lòng bạn.
        Việc chọn bài hoàn toàn dựa trên <strong>trực giác</strong>.
      </p>
    </section>

    <!-- ================= TAROT STAGE ================= -->
    <section class="tarot-stage" data-tarot-stage>

      <!-- GAME SPACE = MAP -->
      <div class="tarot-game-space tarot-deck-area" data-tarot-space>

        <!-- ================= TOP STAGE ================= -->
        <div class="tarot-stage-top" data-tarot-stage-top>

          <!-- ===== DECK A: ÚP (SOURCE) ===== -->
          <div class="tarot-col tarot-col--left" data-tarot-col="A">
            <div
              class="tarot-deck-stack deck-a"
              id="deck-closed"
              data-deck="A"
              data-deck-role="source"
            >
              <div class="tarot-deck tarot-deck--source" data-deck-visual>
                <img
                  src="https://cdn.jsdelivr.net/gh/cuongpham0212/kho-anh@main/tarot/anh-mat-sau-la-bai-tarot.webp"
                  alt="Tarot deck"
                  data-card-face="back"
                />
              </div>
            </div>

            <div class="tarot-shuffle-box">
              <button
                id="btn-shuffle"
                class="tarot-btn"
                type="button"
                data-action="shuffle"
              >
                Xào bài
              </button>
            </div>
          </div>

          <!-- ===== DECK B: XÀO (SHUFFLE) ===== -->
          <div class="tarot-col tarot-col--right" data-tarot-col="B">
            <div
              class="tarot-deck-stack deck-b"
              id="deck-shuffle"
              data-deck="B"
              data-deck-role="shuffle"
            >

              <div class="tarot-deck tarot-deck--shuffle" data-deck-visual>
                <img
                  src="https://cdn.jsdelivr.net/gh/cuongpham0212/kho-anh@main/tarot/anh-mat-sau-la-bai-tarot.webp"
                  alt="Shuffled deck"
                  data-card-face="back"
                />
              </div>

              <!-- SLOT HIỆU ỨNG XÀO -->
              <div
                class="tarot-shuffle-stage"
                data-shuffle-stage
              ></div>

            </div>
          </div>

        </div>
        <!-- /top -->

        <!-- ================= BOTTOM STAGE ================= -->
        <div class="tarot-stage-bottom" data-tarot-stage-bottom>

          <!-- ===== DECK FLAT: GOM BÀI (CẦU NỐI) ===== -->
          <div
            class="tarot-flat-deck"
            data-deck-flat
            aria-hidden="true"
          ></div>

          <!-- ===== DECK C: TRẢI (TARGET / SPREAD) ===== -->
          <div
            class="tarot-spread-area deck-c"
            id="deck-spread"
            data-deck="C"
            data-deck-role="spread"
          >
            <div
              class="tarot-spread-slots"
              data-spread-slots
            ></div>
          </div>

        </div>
        <!-- /bottom -->

      </div>
      <!-- /game-space -->

    </section>

    <!-- ================= AFTER STAGE ================= -->
    <section class="tarot-after-stage hidden" data-tarot-after>

      <section class="tarot-selected">
        <h2>Ba lá bạn đã chọn</h2>

        <div class="tarot-selected-cards">
          {{ range $i, $label := slice "QUÁ KHỨ" "HIỆN TẠI" "HƯỚNG ĐI" }}
          <div class="tarot-slot-wrap">
            <div class="tarot-slot-label">
              LÁ {{ add $i 1 }} · {{ $label }}
            </div>
            <div
              class="tarot-slot"
              data-slot="{{ add $i 1 }}"
            ></div>
          </div>
          {{ end }}
        </div>
      </section>

      <!-- ACTION: CHỈ CÒN NÚT XEM LUẬN GIẢI -->
      <div class="tarot-action">
        <button
          id="btn-reading"
          class="tarot-btn is-disabled"
          disabled
          data-action="reading"
        >
          Xem luận giải
        </button>
      </div>

      <!-- NỘI DUNG LUẬN GIẢI -->
      <article
        id="reading-content"
        class="tarot-reading hidden"
        data-reading-content
      ></article>

      <!-- FOOTER: NÚT RESET (SAU NỘI DUNG) -->
      <div class="tarot-reading-footer">
        <button
          id="btn-reset"
          class="tarot-btn hidden"
          type="button"
          data-action="reset"
        >
          Xem trải bài khác
        </button>
      </div>

    </section>

  </div>
</div>

{{ $tarot := resources.Get "js/tarot/tarot-map-app.js"
  | js.Build (dict
      "format" "esm"
      "targetPath" "js/tarot-map-app.js"
    )
  | resources.Fingerprint
}}

<script
  type="module"
  src="{{ $tarot.RelPermalink }}"
  integrity="{{ $tarot.Data.Integrity }}"
></script>

{{ end }}
