{{ define "main" }}

<!-- G·ªçi l·∫°i CSS article d√πng chung -->
<link rel="stylesheet" href="/css/module/tarot.article.css">

{{/* ===== AUTO DETECT NƒÇM T·ª¨ VI M·ªöI NH·∫§T ===== */}}
{{ $year := "" }}
{{ range where .Site.RegularPages "Section" "tu-vi" }}
  {{ if findRE `^/tu-vi/nam-[0-9]{4}/` .RelPermalink }}
    {{ $y := replaceRE `^/tu-vi/nam-([0-9]{4})/.*` "$1" .RelPermalink }}
    {{ if or (eq $year "") (gt $y $year) }}
      {{ $year = $y }}
    {{ end }}
  {{ end }}
{{ end }}

<article class="tarot-article tuvi-article container">

  <!-- ===== TOC OVERLAY (n·∫øu c√≥) ===== -->
  {{ partial "article-toc-overlay.html" . }}

  <!-- ===== HEADER ===== -->
  <header class="tarot-header">

    <h1 class="tarot-title">{{ .Title }}</h1>

    {{ with .Params.image }}
      <figure class="tarot-figure">
        <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy" />
      </figure>
    {{ end }}

    {{ with .Params.summary }}
      <p class="tarot-summary">{{ . }}</p>
    {{ end }}

  </header>

  <!-- ===== CONTENT ===== -->
  <section class="tarot-content">
    {{ .Content }}
  </section>

  <!-- ===== üîÆ DANH S√ÅCH 12 CUNG (AUTO THEO NƒÇM) ===== -->
  {{ if $year }}
  <section class="tu-vi-year-zodiac-list">
    <h2>T·ª≠ vi nƒÉm {{ $year }} theo 12 cung ho√†ng ƒë·∫°o</h2>

    <ul class="zodiac-grid">
      <li><a href="/tu-vi/nam-{{ $year }}/bach-duong/">‚ôà B·∫°ch D∆∞∆°ng</a></li>
      <li><a href="/tu-vi/nam-{{ $year }}/kim-nguu/">‚ôâ Kim Ng∆∞u</a></li>
      <li><a href="/tu-vi/nam-{{ $year }}/song-tu/">‚ôä Song T·ª≠</a></li>
      <li><a href="/tu-vi/nam-{{ $year }}/cu-giai/">‚ôã C·ª± Gi·∫£i</a></li>
      <li><a href="/tu-vi/nam-{{ $year }}/su-tu/">‚ôå S∆∞ T·ª≠</a></li>
      <li><a href="/tu-vi/nam-{{ $year }}/xu-nu/">‚ôç X·ª≠ N·ªØ</a></li>
      <li><a href="/tu-vi/nam-{{ $year }}/thien-binh/">‚ôé Thi√™n B√¨nh</a></li>
      <li><a href="/tu-vi/nam-{{ $year }}/bo-cap/">‚ôè B·ªç C·∫°p</a></li>
      <li><a href="/tu-vi/nam-{{ $year }}/nhan-ma/">‚ôê Nh√¢n M√£</a></li>
      <li><a href="/tu-vi/nam-{{ $year }}/ma-ket/">‚ôë Ma K·∫øt</a></li>
      <li><a href="/tu-vi/nam-{{ $year }}/bao-binh/">‚ôí B·∫£o B√¨nh</a></li>
      <li><a href="/tu-vi/nam-{{ $year }}/song-ngu/">‚ôì Song Ng∆∞</a></li>
    </ul>
  </section>
  {{ end }}

  <!-- ===== CONTEMPLATION / GUIDANCE (OPTIONAL) ===== -->
  {{ with .Params.guidance }}
  <aside class="tarot-contemplation">
    <h2>G·ª£i √Ω chi√™m nghi·ªám</h2>
    <ul>
      {{ range . }}
        <li>{{ . }}</li>
      {{ end }}
    </ul>
  </aside>
  {{ end }}

  <!-- ===== NAVIGATION (TRONG C√ôNG YEAR) ===== -->
  <nav class="tarot-nav">

    {{ with .PrevInSection }}
      <a class="tarot-prev" href="{{ .RelPermalink }}">
        ‚Üê {{ .Title }}
      </a>
    {{ end }}

    {{ with .NextInSection }}
      <a class="tarot-next" href="{{ .RelPermalink }}">
        {{ .Title }} ‚Üí
      </a>
    {{ end }}

  </nav>

  <!-- ===== FOOTER ===== -->
  {{ if $year }}
  <footer class="tarot-footer">
    <a class="tarot-backlink" href="{{ printf "/tu-vi/nam-%s/" $year | relURL }}">
      ‚Üê Quay l·∫°i T·ª≠ vi nƒÉm {{ $year }}
    </a>
  </footer>
  {{ end }}

</article>

<!-- ===== CSS NH·∫∏ CHO LIST 12 CUNG ===== -->
<style>
.tu-vi-year-zodiac-list {
  margin: 40px 0;
}

.zodiac-grid {
  list-style: none;
  padding: 0;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 10px;
}

.zodiac-grid a {
  display: block;
  padding: 10px 12px;
  background: rgba(0,0,0,.04);
  border-radius: 8px;
  text-decoration: none;
  color: #111;
  font-weight: 500;
}

.zodiac-grid a:hover {
  background: rgba(196,0,0,.08);
  color: #c40000;
}
</style>

{{ end }}
