<div class="tu-vi-find-container">

  <!-- N√öT TOGGLE -->
  <button class="tu-vi-find-toggle"
          type="button"
          onclick="toggleZodiacBox()">
    üîç X√°c ƒë·ªãnh cung ho√†ng ƒë·∫°o
  </button>

  <!-- BOX N·ªòI DUNG (GI·ªÆ NGUY√äN LOGIC C≈®) -->
  <div class="tu-vi-find-zodiac-box" id="zodiac-box">

    <div class="tu-vi-find-header">
      <h3>X√°c ƒë·ªãnh cung ho√†ng ƒë·∫°o</h3>
      <p class="tu-vi-find-note">
        C√¥ng c·ª• n√†y ch·ªâ gi√∫p b·∫°n bi·∫øt m√¨nh thu·ªôc cung n√†o theo ng√†y sinh.
      </p>
    </div>

    <div class="tu-vi-find-form">

      <!-- NG√ÄY -->
      <div class="picker-wrapper">
        <button type="button" class="picker-btn" onclick="togglePicker('day')">
          <span id="day-label">Ng√†y</span>
        </button>
        <div class="picker-grid day-grid" id="day-picker"></div>
      </div>

      <!-- TH√ÅNG -->
      <div class="picker-wrapper">
        <button type="button" class="picker-btn" onclick="togglePicker('month')">
          <span id="month-label">Th√°ng</span>
        </button>
        <div class="picker-grid month-grid" id="month-picker"></div>
      </div>

      <button type="button" onclick="findZodiac()">X√°c ƒë·ªãnh cung</button>
    </div>

    <p id="zodiac-result" class="tu-vi-find-result"></p>

  </div>
</div>

<script>
/* ===== TOGGLE BOX ===== */
function toggleZodiacBox() {
  document.getElementById("zodiac-box")
    .classList.toggle("is-open");
}

let selectedDay = null;
let selectedMonth = null;

/* ===== DATA ===== */
const zodiac = [
  { key:"ma-ket", ten:"Ma K·∫øt", from:[22,12], to:[19,1], element:"ƒê·∫•t" },
  { key:"bao-binh", ten:"B·∫£o B√¨nh", from:[20,1], to:[18,2], element:"Kh√≠" },
  { key:"song-ngu", ten:"Song Ng∆∞", from:[19,2], to:[20,3], element:"N∆∞·ªõc" },
  { key:"bach-duong", ten:"B·∫°ch D∆∞∆°ng", from:[21,3], to:[19,4], element:"L·ª≠a" },
  { key:"kim-nguu", ten:"Kim Ng∆∞u", from:[20,4], to:[20,5], element:"ƒê·∫•t" },
  { key:"song-tu", ten:"Song T·ª≠", from:[21,5], to:[20,6], element:"Kh√≠" },
  { key:"cu-giai", ten:"C·ª± Gi·∫£i", from:[21,6], to:[22,7], element:"N∆∞·ªõc" },
  { key:"su-tu", ten:"S∆∞ T·ª≠", from:[23,7], to:[22,8], element:"L·ª≠a" },
  { key:"xu-nu", ten:"X·ª≠ N·ªØ", from:[23,8], to:[22,9], element:"ƒê·∫•t" },
  { key:"thien-binh", ten:"Thi√™n B√¨nh", from:[23,9], to:[22,10], element:"Kh√≠" },
  { key:"bo-cap", ten:"B·ªç C·∫°p", from:[23,10], to:[21,11], element:"N∆∞·ªõc" },
  { key:"nhan-ma", ten:"Nh√¢n M√£", from:[22,11], to:[21,12], element:"L·ª≠a" }
];

function detectZodiac(day, month) {
  return zodiac.find(z =>
    (month === z.from[1] && day >= z.from[0]) ||
    (month === z.to[1] && day <= z.to[0])
  );
}

/* ===== PICKER ===== */
function togglePicker(type) {
  document.getElementById(type + "-picker").classList.toggle("open");
}

function selectDay(day) {
  selectedDay = day;
  document.getElementById("day-label").textContent = day;
  document.getElementById("day-picker").classList.remove("open");
}

function selectMonth(month) {
  selectedMonth = month;
  document.getElementById("month-label").textContent = "Th√°ng " + month;
  document.getElementById("month-picker").classList.remove("open");
}

/* ===== FIND ===== */
function findZodiac() {
  const result = document.getElementById("zodiac-result");

  if (!selectedDay || !selectedMonth) {
    result.textContent = "Vui l√≤ng ch·ªçn ng√†y v√† th√°ng sinh.";
    return;
  }

  const z = detectZodiac(selectedDay, selectedMonth);
  if (z) {
    result.innerHTML = `
      B·∫°n thu·ªôc cung <strong>${z.ten}</strong> (${z.element})<br>
      <a class="tu-vi-find-cta"
         href="/tu-vi/cung-hoang-dao/${z.key}/">
        üëâ Xem cung n√†y n√≥i g√¨ v·ªÅ b·∫°n ‚Üí
      </a>
    `;
  }
}

/* ===== INIT GRID ===== */
const dayGrid = document.getElementById("day-picker");
for (let i = 1; i <= 31; i++) {
  dayGrid.innerHTML += `<button onclick="selectDay(${i})">${i}</button>`;
}

const monthGrid = document.getElementById("month-picker");
for (let i = 1; i <= 12; i++) {
  monthGrid.innerHTML += `<button onclick="selectMonth(${i})">${i}</button>`;
}

document.addEventListener("click", function (e) {
  const box = document.getElementById("zodiac-box");
  const toggle = document.querySelector(".tu-vi-find-toggle");

  if (!box || !toggle) return;

  const clickedInsideBox = box.contains(e.target);
  const clickedToggle = toggle.contains(e.target);

  if (!clickedInsideBox && !clickedToggle) {
    box.classList.remove("is-open");
  }
});

</script>

<style>
/* ===== CONTAINER ===== */
.tu-vi-find-container {
  position: relative;
  display: inline-block;
  margin: 16px auto 28px;
}

/* ===== N√öT TOGGLE ===== */
.tu-vi-find-toggle {
  padding: 6px 14px;
  font-size: .9rem;
  border-radius: 999px;
  background: #111827;
  color: #fff;
  cursor: pointer;
}

/* ===== BOX ===== */
.tu-vi-find-zodiac-box {
  position: absolute;
  top: 115%;
  left: 50%;
  transform: translateX(-50%) translateY(-6px);

  width: 360px;
  padding: 16px 18px;
  background: #ffffff;
  border-radius: 14px;
  box-shadow: 0 18px 40px rgba(0,0,0,.18);

  opacity: 0;
  pointer-events: none;
  transition: all .25s ease;
  z-index: 30;
}

/* HI·ªÜN BOX */
.tu-vi-find-zodiac-box.is-open {
  opacity: 1;
  pointer-events: auto;
  transform: translateX(-50%) translateY(0);
}

/* ===== FORM ===== */
.tu-vi-find-form {
  display: flex;
  gap: 8px;
  justify-content: center;
  align-items: center;
}

/* ===== PICKER (GI·ªÆ NGUY√äN) ===== */
.picker-wrapper {
  position: relative;
}

.picker-btn {
  padding: 6px 10px;
  font-size: .85rem;
  border-radius: 6px;
  background: #f3f4f6;
  cursor: pointer;
}

.picker-grid {
  position: absolute;
  top: 110%;
  left: 0;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0,0,0,.15);
  padding: 8px;
  display: none;
  gap: 6px;
  z-index: 40;
}

.picker-grid.open {
  display: grid;
}

.day-grid {
  grid-template-columns: repeat(5, 1fr);
}

.month-grid {
  grid-template-columns: repeat(2, 1fr);
}

.picker-grid button {
  padding: 6px;
  font-size: .8rem;
  border-radius: 6px;
  background: #f9fafb;
  cursor: pointer;
}

.picker-grid button:hover {
  background: #111827;
  color: #fff;
}

/* ===== HI·ªÜU ·ª®NG ƒê√ìNG M∆Ø·ª¢T ===== */
.tu-vi-find-zodiac-box {
  will-change: opacity, transform;
}

</style>
