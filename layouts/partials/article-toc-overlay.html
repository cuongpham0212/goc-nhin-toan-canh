{{/* =====================================================
     ARTICLE TOC OVERLAY – MOBILE & DESKTOP OPTIMIZED
===================================================== */}}

<!-- ===== TOGGLE BUTTON ===== -->
<button id="toc-toggle"
  aria-label="Mở mục lục bài viết"
  class="article-toc-btn">
  ☰
</button>

<!-- ===== TOC PANEL ===== -->
<div id="toc-panel" class="article-toc-panel hidden dimmed">
  <div class="article-toc-header">
    <span>Nội dung</span>
    <button id="toc-close" aria-label="Đóng">✕</button>
  </div>

  <nav class="article-toc-content">
    {{ .TableOfContents }}
  </nav>
</div>

<!-- ===== CSS ===== -->
<style>
/* ===== Toggle button ===== */
.article-toc-btn {
  position: fixed;
  right: 16px;
  bottom: 22%;
  z-index: 50;
  padding: 10px 12px;
  border-radius: 999px;
  background: rgba(0,0,0,.65);
  color: #fff;
  font-size: 16px;
}

/* ===== TOC panel base ===== */
.article-toc-panel {
  position: fixed;
  right: 16px;
  bottom: calc(22% + 52px);
  width: 260px;
  max-height: 60vh;
  z-index: 60;

  background: rgba(255,255,255,.75);
  backdrop-filter: blur(10px);
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,.15);

  transition: opacity .3s ease, transform .25s ease;
}

/* ===== Hidden ===== */
.hidden {
  display: none;
}

/* ===== Auto dim (khi không dùng) ===== */
.article-toc-panel.dimmed {
  opacity: .35;
}

/* ===== Active / hover ===== */
.article-toc-panel:hover,
.article-toc-panel.active {
  opacity: 1;
}

/* ===== Header ===== */
.article-toc-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 14px;
  font-weight: 600;
  font-size: 14px;
}

/* ===== Content ===== */
.article-toc-content {
  padding: 10px 14px;
  overflow-y: auto;
  font-size: 14px;
}

.article-toc-content ul {
  list-style: none;
  padding-left: 0;
}

.article-toc-content li {
  margin: 6px 0;
}

.article-toc-content a {
  color: #222;
  text-decoration: none;
}

.article-toc-content a:hover {
  text-decoration: underline;
}

/* ===== MOBILE ADJUST ===== */
@media (max-width: 768px) {
  .article-toc-panel {
    left: 50%;
    right: auto;
    bottom: 18%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 320px;
  }
}
</style>

<!-- ===== JS ===== -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const toggle = document.getElementById("toc-toggle");
  const panel = document.getElementById("toc-panel");
  const closeBtn = document.getElementById("toc-close");

  if (!toggle || !panel) return;

  toggle.addEventListener("click", () => {
    panel.classList.remove("hidden");
    panel.classList.add("active");
    panel.classList.remove("dimmed");
  });

  function hideTOC() {
    panel.classList.remove("active");
    panel.classList.add("dimmed");
    setTimeout(() => panel.classList.add("hidden"), 200);
  }

  closeBtn?.addEventListener("click", hideTOC);

  // Auto dim sau 3s không tương tác
  let dimTimer;
  panel.addEventListener("mouseenter", () => {
    panel.classList.remove("dimmed");
    clearTimeout(dimTimer);
  });

  panel.addEventListener("mouseleave", () => {
    dimTimer = setTimeout(() => {
      panel.classList.add("dimmed");
    }, 3000);
  });
});
</script>
