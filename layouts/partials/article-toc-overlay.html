{{/* =====================================================
     ARTICLE TOC OVERLAY â€“ AUTO CLOSE ON LINK CLICK
     FIX: PANEL AUTO HEIGHT + SCROLL CONTENT ONLY
===================================================== */}}

<!-- ===== TOGGLE BUTTON ===== -->
<button id="toc-toggle"
  aria-label="Má»Ÿ má»¥c lá»¥c bÃ i viáº¿t"
  class="article-toc-btn dimmed">
  â˜°
</button>

<!-- ===== TOC PANEL ===== -->
<div id="toc-panel" class="article-toc-panel hidden dimmed">
  <div class="article-toc-header">
    <span>Ná»™i dung</span>
    <button id="toc-close" aria-label="ÄÃ³ng">âœ•</button>
  </div>

  <nav class="article-toc-content">
    {{ .TableOfContents }}
  </nav>
</div>

<!-- ===== CSS ===== -->
<style>
/* ===== TOGGLE ===== */
.article-toc-btn {
  position: fixed;
  left: 16px;
  bottom: 22%;
  z-index: 50;
  padding: 10px 12px;
  border-radius: 999px;
  background: rgba(0,0,0,.65);
  color: #fff;
  font-size: 16px;
  cursor: pointer;
  transition: opacity .3s ease;
}

/* ===== PANEL ===== */
.article-toc-panel {
  position: fixed;
  left: 16px;
  bottom: calc(22% + 52px);
  width: 260px;

  /* ðŸ”¥ QUAN TRá»ŒNG */
  max-height: 75vh;          /* cao hÆ¡n Ä‘á»ƒ chá»©a bÃ i pillar */
  display: flex;
  flex-direction: column;   /* header + content tÃ¡ch biá»‡t */

  z-index: 60;
  background: rgba(255,255,255,.45);
  backdrop-filter: blur(10px);
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,.12);
  transition: opacity .3s ease;
}

/* ===== DIM ===== */
.dimmed { opacity: .45; }

.article-toc-panel.active,
.article-toc-btn.active { opacity: 1; }

.hidden { display: none; }

/* ===== HEADER (KHÃ”NG SCROLL) ===== */
.article-toc-header {
  flex-shrink: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 14px;
  font-weight: 600;
  font-size: 14px;
  border-bottom: 1px solid rgba(0,0,0,.08);
}

/* ===== CONTENT (SCROLL Tá»° NHIÃŠN) ===== */
.article-toc-content {
  padding: 10px 14px;
  overflow-y: auto;     /* âœ… CHá»ˆ SCROLL PHáº¦N NÃ€Y */
  font-size: 14px;
}

/* ===== LIST ===== */
.article-toc-content ul {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

.article-toc-content li {
  margin: 6px 0;
  line-height: 1.4;
}

.article-toc-content a {
  color: #111;
  text-decoration: none;
}

.article-toc-content a:hover {
  text-decoration: underline;
}

/* ===== MOBILE ===== */
@media (max-width: 768px) {
  .article-toc-panel {
    width: 88%;
    max-width: 340px;
    bottom: 16%;
    max-height: 70vh;
    background: rgba(255,255,255,.30);
  }

  .dimmed { opacity: .35; }
}
</style>

<!-- ===== JS ===== -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const toggle = document.getElementById("toc-toggle");
  const panel = document.getElementById("toc-panel");
  const closeBtn = document.getElementById("toc-close");
  const tocLinks = panel?.querySelectorAll("a");

  if (!toggle || !panel) return;

  let dimTimer;

  function activate() {
    toggle.classList.add("active");
    toggle.classList.remove("dimmed");
    panel.classList.add("active");
    panel.classList.remove("dimmed");
    clearTimeout(dimTimer);
  }

  function autoDim() {
    clearTimeout(dimTimer);
    dimTimer = setTimeout(() => {
      toggle.classList.remove("active");
      toggle.classList.add("dimmed");
      panel.classList.remove("active");
      panel.classList.add("dimmed");
    }, 2000);
  }

  function hidePanel() {
    panel.classList.add("hidden");
    autoDim();
  }

  /* ===== TOGGLE ===== */
  toggle.addEventListener("click", (e) => {
    e.stopPropagation();
    panel.classList.remove("hidden");
    activate();
    autoDim();
  });

  closeBtn?.addEventListener("click", hidePanel);

  /* ===== CLICK NGOÃ€I â†’ ÄÃ“NG ===== */
  document.addEventListener("click", (e) => {
    if (!panel.contains(e.target) && !toggle.contains(e.target)) {
      hidePanel();
    }
  });

  document.addEventListener("touchstart", (e) => {
    if (!panel.contains(e.target) && !toggle.contains(e.target)) {
      hidePanel();
    }
  });

  /* ===== CLICK LINK â†’ SCROLL + ÄÃ“NG ===== */
  tocLinks?.forEach(link => {
    link.addEventListener("click", () => {
      hidePanel();
    });
  });

  window.addEventListener("scroll", autoDim, { passive: true });

  panel.addEventListener("mouseenter", activate);
  panel.addEventListener("touchstart", activate);

  autoDim();
});
</script>
