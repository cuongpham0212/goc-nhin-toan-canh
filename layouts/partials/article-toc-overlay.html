{{/* =====================================================
     ARTICLE TOC OVERLAY ‚Äì LEFT HAND MOBILE UX
===================================================== */}}

<!-- ===== TOGGLE BUTTON ===== -->
<button id="toc-toggle"
  aria-label="M·ªü m·ª•c l·ª•c b√†i vi·∫øt"
  class="article-toc-btn dimmed">
  ‚ò∞
</button>

<!-- ===== TOC PANEL ===== -->
<div id="toc-panel" class="article-toc-panel hidden dimmed">
  <div class="article-toc-header">
    <span>N·ªôi dung</span>
    <button id="toc-close" aria-label="ƒê√≥ng">‚úï</button>
  </div>

  <nav class="article-toc-content">
    {{ .TableOfContents }}
  </nav>
</div>

<!-- ===== CSS ===== -->
<style>
/* ===== Toggle button ===== */
.article-toc-btn {
  position: fixed;
  left: 16px;              /* ‚¨Ö LEFT HAND */
  right: auto;
  bottom: 22%;
  z-index: 50;
  padding: 10px 12px;
  border-radius: 999px;
  background: rgba(0,0,0,.65);
  color: #fff;
  font-size: 16px;
  transition: opacity .3s ease;
}

/* ===== TOC panel base ===== */
.article-toc-panel {
  position: fixed;
  left: 16px;              /* ‚¨Ö LEFT HAND */
  right: auto;
  bottom: calc(22% + 52px);
  width: 260px;
  max-height: 60vh;
  z-index: 60;

  background: rgba(255,255,255,.45);
  backdrop-filter: blur(10px);
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,.12);

  transition: opacity .3s ease, transform .25s ease;
}

/* ===== Dim state ===== */
.dimmed {
  opacity: .45;
}

/* ===== Active ===== */
.article-toc-panel.active,
.article-toc-btn.active {
  opacity: 1;
}

/* ===== Hidden ===== */
.hidden {
  display: none;
}

/* ===== Header ===== */
.article-toc-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 14px;
  font-weight: 600;
  font-size: 14px;
}

/* ===== Content ===== */
.article-toc-content {
  padding: 10px 14px;
  overflow-y: auto;
  font-size: 14px;
}

.article-toc-content ul {
  list-style: none;
  padding-left: 0;
}

.article-toc-content li {
  margin: 6px 0;
}

.article-toc-content a {
  color: #111;
  text-decoration: none;
}

/* ===== MOBILE TUNE ===== */
@media (max-width: 768px) {
  .article-toc-panel {
    width: 88%;
    max-width: 320px;
    bottom: 18%;
    background: rgba(255,255,255,.30); /* nh·∫π h∆°n mobile */
  }

  .dimmed {
    opacity: .35;
  }
}
</style>

<!-- ===== JS ===== -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const toggle = document.getElementById("toc-toggle");
  const panel = document.getElementById("toc-panel");
  const closeBtn = document.getElementById("toc-close");

  if (!toggle || !panel) return;

  let dimTimer;

  function activate() {
    toggle.classList.add("active");
    toggle.classList.remove("dimmed");
    panel.classList.add("active");
    panel.classList.remove("dimmed");
    clearTimeout(dimTimer);
  }

  function autoDim() {
    clearTimeout(dimTimer);
    dimTimer = setTimeout(() => {
      toggle.classList.remove("active");
      toggle.classList.add("dimmed");
      panel.classList.remove("active");
      panel.classList.add("dimmed");
    }, 2500);
  }

  function hidePanel() {
    panel.classList.add("hidden");
    autoDim();
  }

  toggle.addEventListener("click", (e) => {
    e.stopPropagation();
    panel.classList.remove("hidden");
    activate();
    autoDim();
  });

  closeBtn?.addEventListener("click", hidePanel);

  /* üëâ CLICK / TAP NGO√ÄI PANEL ‚Üí T·∫ÆT */
  document.addEventListener("click", (e) => {
    if (
      !panel.contains(e.target) &&
      !toggle.contains(e.target)
    ) {
      hidePanel();
    }
  });

  /* üëâ TOUCH NGO√ÄI (mobile) */
  document.addEventListener("touchstart", (e) => {
    if (
      !panel.contains(e.target) &&
      !toggle.contains(e.target)
    ) {
      hidePanel();
    }
  });

  /* Scroll = quay l·∫°i ƒë·ªçc ‚Üí dim */
  window.addEventListener("scroll", autoDim, { passive: true });

  /* Ch·∫°m panel = focus */
  panel.addEventListener("touchstart", activate);
  panel.addEventListener("mouseenter", activate);

  /* Tr·∫°ng th√°i ban ƒë·∫ßu */
  autoDim();
});
</script>
