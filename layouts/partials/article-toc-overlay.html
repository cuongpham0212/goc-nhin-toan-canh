{{/* =====================================================
     ARTICLE TOC OVERLAY – AUTO DIM (MOBILE FIRST)
===================================================== */}}

<!-- ===== TOGGLE BUTTON ===== -->
<button id="toc-toggle"
  aria-label="Mở mục lục bài viết"
  class="article-toc-btn dimmed">
  ☰
</button>

<!-- ===== TOC PANEL ===== -->
<div id="toc-panel" class="article-toc-panel hidden dimmed">
  <div class="article-toc-header">
    <span>Nội dung</span>
    <button id="toc-close" aria-label="Đóng">✕</button>
  </div>

  <nav class="article-toc-content">
    {{ .TableOfContents }}
  </nav>
</div>

<!-- ===== CSS ===== -->
<style>
/* ===== Toggle button ===== */
.article-toc-btn {
  position: fixed;
  right: 16px;
  bottom: 22%;
  z-index: 50;
  padding: 10px 12px;
  border-radius: 999px;
  background: rgba(0,0,0,.65);
  color: #fff;
  font-size: 16px;
  transition: opacity .3s ease;
}

/* ===== TOC panel base ===== */
.article-toc-panel {
  position: fixed;
  right: 16px;
  bottom: calc(22% + 52px);
  width: 260px;
  max-height: 60vh;
  z-index: 60;

  background: rgba(255,255,255,.45); /* ⬅ giảm mạnh */
  backdrop-filter: blur(10px);
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,.12);

  transition: opacity .3s ease, transform .25s ease;
}

/* ===== Dim state ===== */
.dimmed {
  opacity: .45;
}

/* ===== Active / focus ===== */
.article-toc-panel.active,
.article-toc-btn.active {
  opacity: 1;
}

/* ===== Hidden ===== */
.hidden {
  display: none;
}

/* ===== Header ===== */
.article-toc-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 14px;
  font-weight: 600;
  font-size: 14px;
}

/* ===== Content ===== */
.article-toc-content {
  padding: 10px 14px;
  overflow-y: auto;
  font-size: 14px;
}

.article-toc-content ul {
  list-style: none;
  padding-left: 0;
}

.article-toc-content li {
  margin: 6px 0;
}

.article-toc-content a {
  color: #111;
  text-decoration: none;
}

/* ===== MOBILE ADJUST ===== */
@media (max-width: 768px) {
  .article-toc-panel {
    left: 50%;
    right: auto;
    bottom: 18%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 320px;

    background: rgba(255,255,255,.30); /* ⬅ giảm thêm 1/2 cho mobile */
  }

  .dimmed {
    opacity: .35;
  }
}
</style>

<!-- ===== JS ===== -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const toggle = document.getElementById("toc-toggle");
  const panel = document.getElementById("toc-panel");
  const closeBtn = document.getElementById("toc-close");

  if (!toggle || !panel) return;

  let dimTimer;

  function activate() {
    toggle.classList.add("active");
    toggle.classList.remove("dimmed");
    panel.classList.add("active");
    panel.classList.remove("dimmed");
    clearTimeout(dimTimer);
  }

  function autoDim() {
    clearTimeout(dimTimer);
    dimTimer = setTimeout(() => {
      toggle.classList.remove("active");
      toggle.classList.add("dimmed");
      panel.classList.remove("active");
      panel.classList.add("dimmed");
    }, 2500);
  }

  toggle.addEventListener("click", () => {
    panel.classList.remove("hidden");
    activate();
    autoDim();
  });

  closeBtn?.addEventListener("click", () => {
    panel.classList.add("hidden");
    autoDim();
  });

  // User scroll → coi như đang đọc → dim lại
  window.addEventListener("scroll", autoDim, { passive: true });

  // Chạm vào panel → rõ lại
  panel.addEventListener("touchstart", activate);
  panel.addEventListener("mouseenter", activate);

  // Bắt đầu trạng thái mờ
  autoDim();
});
</script>
